{% extends 'web/base.html' %}

{% block content %}
<style>
    th a { color: #333; text-decoration: none; display: flex; align-items: center; justify-content: space-between; }
    th a:hover { color: #007bff; }
    .sort-icon { font-size: 12px; margin-left: 5px; color: #999; }
    th.active-sort { background-color: #e9ecef; }

    .pagination { display: flex; justify-content: center; align-items: center; gap: 5px; margin-top: 20px; }
    .pagination-link { text-decoration: none; padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px; color: #007bff; }
    .pagination-link:hover { background-color: #eee; }
    .current-page { padding: 5px 10px; font-weight: bold; background-color: #007bff; color: white; border-radius: 4px; }
</style>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <h2>–í–∏–∫–æ–Ω–∞–≤—Ü—ñ</h2>
    <a href="{% url 'dashboard' %}" class="btn btn-primary">üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</a>
</div>

<form method="get" style="margin-bottom: 20px; display: flex; gap: 10px;">
    <input type="text" name="q" class="form-control" placeholder="–ü–æ—à—É–∫ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤..." value="{{ query }}">
    <input type="hidden" name="sort" value="{{ current_sort }}">
    <input type="hidden" name="order" value="{{ current_order }}">
    <button class="btn btn-secondary">–ü–æ—à—É–∫</button>
</form>

<table class="table table-striped">
    <thead>
        <tr>
            <th class="{% if current_sort == 'id' %}active-sort{% endif %}">
                <a href="?sort=id&order={% if current_sort == 'id' and current_order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">
                    ID <span class="sort-icon">‚Üï</span>
                </a>
            </th>
            <th class="{% if current_sort == 'nickname' %}active-sort{% endif %}">
                <a href="?sort=nickname&order={% if current_sort == 'nickname' and current_order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">
                    –ü—Å–µ–≤–¥–æ–Ω—ñ–º <span class="sort-icon">‚Üï</span>
                </a>
            </th>
            <th class="{% if current_sort == 'real_name' %}active-sort{% endif %}">
                <a href="?sort=real_name&order={% if current_sort == 'real_name' and current_order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">
                    –°–ø—Ä–∞–≤–∂–Ω—î —ñ–º'—è <span class="sort-icon">‚Üï</span>
                </a>
            </th>
            <th class="{% if current_sort == 'country' %}active-sort{% endif %}">
                <a href="?sort=country&order={% if current_sort == 'country' and current_order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">
                    –ö—Ä–∞—ó–Ω–∞ <span class="sort-icon">‚Üï</span>
                </a>
            </th>
            <th class="{% if current_sort == 'songs' %}active-sort{% endif %}">
                <a href="?sort=songs&order={% if current_sort == 'songs' and current_order == 'asc' %}desc{% else %}asc{% endif %}{% if query %}&q={{ query }}{% endif %}">
                    –ü—ñ—Å–µ–Ω—å <span class="sort-icon">‚Üï</span>
                </a>
            </th>
        </tr>
    </thead>
    <tbody>
        {% for artist in artists %}
        <tr>
            <td>{{ artist.pk }}</td>
            <td>
                <a href="{% url 'artist_detail' pk=artist.pk %}" style="text-decoration: none; color: #007bff; font-weight: bold;">
                    {{ artist.nickname }}
                </a>
            </td>
            <td>{{ artist.real_name|default:"-" }}</td>
            <td>{{ artist.country|default:"-" }}</td>
            <td>
                <span style="background: #e9ecef; padding: 2px 8px; border-radius: 10px; font-size: 0.9em;">
                    {{ artist.num_songs }}
                </span>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="5" style="text-align: center;">–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π.</td></tr>
        {% endfor %}
    </tbody>
</table>

{% if page_obj.paginator.num_pages > 1 %}
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page=1&sort={{ current_sort }}&order={{ current_order }}{% if query %}&q={{ query }}{% endif %}" class="pagination-link">¬´ –ü–µ—Ä—à–∞</a>
        <a href="?page={{ page_obj.previous_page_number }}&sort={{ current_sort }}&order={{ current_order }}{% if query %}&q={{ query }}{% endif %}" class="pagination-link">–ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
    {% endif %}

    <span class="current-page">
        –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&sort={{ current_sort }}&order={{ current_order }}{% if query %}&q={{ query }}{% endif %}" class="pagination-link">–ù–∞—Å—Ç—É–ø–Ω–∞</a>
        <a href="?page={{ page_obj.paginator.num_pages }}&sort={{ current_sort }}&order={{ current_order }}{% if query %}&q={{ query }}{% endif %}" class="pagination-link">–û—Å—Ç–∞–Ω–Ω—è ¬ª</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}